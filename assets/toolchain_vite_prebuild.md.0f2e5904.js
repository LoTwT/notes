import{_ as s,c as n,o as a,a as l}from"./app.a067e1d4.js";const i=JSON.parse('{"title":"\u4F9D\u8D56\u9884\u6784\u5EFA","description":"","frontmatter":{},"headers":[{"level":2,"title":"\u6838\u5FC3\u6D41\u7A0B","slug":"\u6838\u5FC3\u6D41\u7A0B","link":"#\u6838\u5FC3\u6D41\u7A0B","children":[{"level":3,"title":"\u7F13\u5B58\u5224\u65AD","slug":"\u7F13\u5B58\u5224\u65AD","link":"#\u7F13\u5B58\u5224\u65AD","children":[]},{"level":3,"title":"\u4F9D\u8D56\u626B\u63CF","slug":"\u4F9D\u8D56\u626B\u63CF","link":"#\u4F9D\u8D56\u626B\u63CF","children":[]},{"level":3,"title":"\u4F9D\u8D56\u6253\u5305","slug":"\u4F9D\u8D56\u6253\u5305","link":"#\u4F9D\u8D56\u6253\u5305","children":[]},{"level":3,"title":"\u5143\u4FE1\u606F\u5199\u5165\u78C1\u76D8","slug":"\u5143\u4FE1\u606F\u5199\u5165\u78C1\u76D8","link":"#\u5143\u4FE1\u606F\u5199\u5165\u78C1\u76D8","children":[]}]},{"level":2,"title":"\u4F9D\u8D56\u626B\u63CF","slug":"\u4F9D\u8D56\u626B\u63CF-1","link":"#\u4F9D\u8D56\u626B\u63CF-1","children":[{"level":3,"title":"\u83B7\u53D6\u5165\u53E3","slug":"\u83B7\u53D6\u5165\u53E3","link":"#\u83B7\u53D6\u5165\u53E3","children":[]},{"level":3,"title":"\u8BB0\u5F55\u4F9D\u8D56","slug":"\u8BB0\u5F55\u4F9D\u8D56","link":"#\u8BB0\u5F55\u4F9D\u8D56","children":[]},{"level":3,"title":"external \u89C4\u5219","slug":"external-\u89C4\u5219","link":"#external-\u89C4\u5219","children":[]}]},{"level":2,"title":"\u4F9D\u8D56\u6253\u5305","slug":"\u4F9D\u8D56\u6253\u5305-1","link":"#\u4F9D\u8D56\u6253\u5305-1","children":[{"level":3,"title":"\u6241\u5E73\u5316\u4EA7\u7269\u6587\u4EF6\u7ED3\u6784","slug":"\u6241\u5E73\u5316\u4EA7\u7269\u6587\u4EF6\u7ED3\u6784","link":"#\u6241\u5E73\u5316\u4EA7\u7269\u6587\u4EF6\u7ED3\u6784","children":[]},{"level":3,"title":"\u4EE3\u7406\u6A21\u5757\u52A0\u8F7D","slug":"\u4EE3\u7406\u6A21\u5757\u52A0\u8F7D","link":"#\u4EE3\u7406\u6A21\u5757\u52A0\u8F7D","children":[]}]}],"relativePath":"toolchain/vite/prebuild.md","lastUpdated":1669599731000}'),p={name:"toolchain/vite/prebuild.md"},o=l(`<h1 id="\u4F9D\u8D56\u9884\u6784\u5EFA" tabindex="-1">\u4F9D\u8D56\u9884\u6784\u5EFA <a class="header-anchor" href="#\u4F9D\u8D56\u9884\u6784\u5EFA" aria-hidden="true">#</a></h1><p>Vite \u4F9D\u8D56\u9884\u6784\u5EFA\u7684\u5E95\u5C42\u5B9E\u73B0\u4E2D\uFF0C\u5927\u91CF\u4F7F\u7528\u4E86 Esbuild \uFF0C\u5B9E\u73B0\u4E86\u6BD4\u8F83\u590D\u6742\u7684 Esbuild \u63D2\u4EF6\uFF0C\u540C\u65F6\u4E5F\u5E94\u7528\u4E86\u8BF8\u591A Esbuild \u4F7F\u7528\u6280\u5DE7\u3002</p><h2 id="\u6838\u5FC3\u6D41\u7A0B" tabindex="-1">\u6838\u5FC3\u6D41\u7A0B <a class="header-anchor" href="#\u6838\u5FC3\u6D41\u7A0B" aria-hidden="true">#</a></h2><p>\u5173\u4E8E\u9884\u6784\u5EFA\u7684\u6240\u6709\u5B9E\u73B0\u4EE3\u7801\u90FD\u5728 <code>optimizeDeps</code> \u51FD\u6570\u4E2D\uFF0C\u8FD9\u4E2A\u51FD\u6570\u5728 <code>packages/vite/src/node/optimizer/index.ts</code> \u4E2D\u3002</p><h3 id="\u7F13\u5B58\u5224\u65AD" tabindex="-1">\u7F13\u5B58\u5224\u65AD <a class="header-anchor" href="#\u7F13\u5B58\u5224\u65AD" aria-hidden="true">#</a></h3><p>\u9996\u5148\u662F\u9884\u6784\u5EFA\u7F13\u5B58\u7684\u5224\u65AD\u3002</p><p>Vite \u5728\u6BCF\u6B21\u9884\u6784\u5EFA\u4E4B\u540E\uFF0C\u90FD\u5C06\u4E00\u4E9B\u5173\u952E\u4FE1\u606F\u5199\u5165\u5230\u4E86 <code>_metadata.json</code> \u6587\u4EF6\u4E2D\uFF0C\u7B2C\u4E8C\u6B21\u542F\u52A8\u9879\u76EE\u65F6\uFF0C\u4F1A\u901A\u8FC7\u8FD9\u4E2A\u6587\u4EF6\u4E2D\u7684 hash \u503C\u6765\u8FDB\u884C\u7F13\u5B58\u7684\u5224\u65AD\uFF0C\u5982\u679C\u547D\u4E2D\u7F13\u5B58\u5219\u4E0D\u4F1A\u8FDB\u884C\u540E\u7EED\u7684\u4E0E\u6784\u5EFA\u6D41\u7A0B\uFF0C\u4EE3\u7801\u5982\u4E0B\uFF1A</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki"><code><span class="line"><span style="color:#676E95;">// _metadata.json \u6587\u4EF6\u6240\u5728\u7684\u8DEF\u5F84</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> dataPath </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">join</span><span style="color:#A6ACCD;">(cacheDir</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">_metadata.json</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#676E95;">// \u6839\u636E\u5F53\u524D\u7684\u914D\u7F6E\u8BA1\u7B97\u51FA\u54C8\u5E0C\u503C</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> mainHash </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">getDepHash</span><span style="color:#A6ACCD;">(root</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> config)</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> data</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">DepOptimizationMetadata</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">hash</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> mainHash</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">browserHash</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> mainHash</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">optimized</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{},</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#676E95;">// \u9ED8\u8BA4\u8D70\u5230\u91CC\u9762\u7684\u903B\u8F91</span></span>
<span class="line"><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">force) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">prevData</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">DepOptimizationMetadata</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">|</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">undefined</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">try</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u8BFB\u53D6\u5143\u6570\u636E</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">prevData</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">JSON</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">parse</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">fs</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">readFileSync</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">dataPath</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">utf-8</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">))</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">catch</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">e</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u5F53\u524D\u8BA1\u7B97\u51FA\u7684\u54C8\u5E0C\u503C\u4E0E _metadata.json \u4E2D\u8BB0\u5F55\u7684\u54C8\u5E0C\u503C\u4E00\u81F4\uFF0C\u8868\u793A\u547D\u4E2D\u7F13\u5B58\uFF0C\u4E0D\u7528\u9884\u6784\u5EFA</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">prevData</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">prevData</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">hash</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">data</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">hash</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Hash is consistent. Skipping. Use --force to override.</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">prevData</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u54C8\u5E0C\u8BA1\u7B97\u7684\u7B56\u7565\uFF0C\u51B3\u5B9A\u54EA\u4E9B\u914D\u7F6E\u548C\u6587\u4EF6\u6709\u53EF\u80FD\u5F71\u54CD\u9884\u6784\u5EFA\u7684\u7ED3\u679C\uFF0C\u6839\u636E\u8FD9\u4E9B\u4FE1\u606F\u6765\u751F\u6210\u54C8\u5E0C\u503C\u3002\u8FD9\u90E8\u5206\u903B\u8F91\u96C6\u4E2D\u5728 <code>getDepHash</code> \u51FD\u6570\u4E2D\uFF0C\u5982\u4E0B\uFF1A</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> lockfileFormats </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> [</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">package-lock.json</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">yarn.lock</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">pnpm-lock.yaml</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">]</span></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">getDepHash</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">root</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">config</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">ResolvedConfig</span><span style="color:#89DDFF;">):</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u83B7\u53D6 lock \u6587\u4EF6\u5185\u5BB9</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">content</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">lookupFile</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">root</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">lockfileFormats</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">||</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u9664\u4E86 lock \u6587\u4EF6\u5916\uFF0C\u8FD8\u9700\u8981\u8003\u8651\u4E0B\u9762\u7684\u4E00\u4E9B\u914D\u7F6E\u4FE1\u606F</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">content</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">JSON</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">stringify</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// \u5F00\u53D1/\u751F\u4EA7\u73AF\u5883</span></span>
<span class="line"><span style="color:#F07178;">      mode</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">config</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">mode</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// \u9879\u76EE\u6839\u8DEF\u5F84</span></span>
<span class="line"><span style="color:#F07178;">      root</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">config</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">root</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// \u8DEF\u5F84\u89E3\u6790\u914D\u7F6E</span></span>
<span class="line"><span style="color:#F07178;">      resolve</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">config</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">resolve</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// \u81EA\u5B9A\u4E49\u8D44\u6E90\u7C7B\u578B</span></span>
<span class="line"><span style="color:#F07178;">      assetsInclude</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">config</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">assetsInclude</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// \u63D2\u4EF6</span></span>
<span class="line"><span style="color:#F07178;">      plugins</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">config</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">plugins</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">map</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">p</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">p</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">name</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// \u9884\u6784\u5EFA\u914D\u7F6E</span></span>
<span class="line"><span style="color:#F07178;">      optimizeDeps</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        include</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">config</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">optimizeDeps</span><span style="color:#89DDFF;">?.</span><span style="color:#A6ACCD;">include</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        exclude</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">config</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">optimizeDeps</span><span style="color:#89DDFF;">?.</span><span style="color:#A6ACCD;">exclude</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u7279\u6B8A\u5904\u7406\u51FD\u6570\u548C\u6B63\u5219\u7C7B\u578B</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">_</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">value</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">typeof</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">value</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">function</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">||</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">value</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">instanceof</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">RegExp</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">value</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">toString</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">value</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">  )</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u6700\u540E\u8C03\u7528 crypto \u5E93\u4E2D\u7684 createHash \u65B9\u6CD5\u751F\u6210\u54C8\u5E0C</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">createHash</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">sha256</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">update</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">content</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">digest</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">hex</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">substring</span><span style="color:#F07178;">(</span><span style="color:#F78C6C;">0</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">8</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="\u4F9D\u8D56\u626B\u63CF" tabindex="-1">\u4F9D\u8D56\u626B\u63CF <a class="header-anchor" href="#\u4F9D\u8D56\u626B\u63CF" aria-hidden="true">#</a></h3><p>\u5982\u679C\u6CA1\u6709\u547D\u4E2D\u7F13\u5B58\uFF0C\u5219\u4F1A\u6B63\u5F0F\u5730\u8FDB\u5165\u4F9D\u8D56\u9884\u6784\u5EFA\u9636\u6BB5\u3002</p><p>\u4F46\u5728\u6B64\u4E4B\u524D\uFF0CVite \u4ECD\u7136\u9700\u8981\u63A2\u6D4B\u9879\u76EE\u4E2D\u5B58\u5728\u54EA\u4E9B\u4F9D\u8D56\uFF0C\u5E76\u6536\u96C6\u4F9D\u8D56\u5217\u8868\uFF0C\u8FD9\u5C31\u662F\u4F9D\u8D56\u626B\u63CF\u7684\u8FC7\u7A0B\u3002\u8FD9\u4E2A\u8FC7\u7A0B\u662F\u5FC5\u987B\u7684\uFF0C\u56E0\u4E3A Esbuild \u9700\u8981\u77E5\u9053\u5230\u5E95\u8981\u6253\u5305\u54EA\u4E9B\u7B2C\u4E09\u65B9\u4F9D\u8D56\uFF0C\u5173\u952E\u4EE3\u7801\u5982\u4E0B\uFF1A</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki"><code><span class="line"><span style="color:#89DDFF;">;</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> deps</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> missing </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">await</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">scanImports</span><span style="color:#A6ACCD;">(config))</span></span>
<span class="line"></span></code></pre></div><p>\u5728 <code>scanImports</code> \u65B9\u6CD5\u5185\u90E8\u4E3B\u8981\u4F1A\u8C03\u7528 Esbuild \u63D0\u4F9B\u7684 build \u65B9\u6CD5\uFF1A</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> deps</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Record</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"><span style="color:#676E95;">// \u626B\u63CF\u7528\u5230\u7684 Esbuild \u63D2\u4EF6</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> plugin </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">esbuildScanPlugin</span><span style="color:#A6ACCD;">(config</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> container</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> deps</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> missing</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> entries)</span></span>
<span class="line"><span style="color:#89DDFF;">await</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Promise</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">all</span><span style="color:#A6ACCD;">(</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u5E94\u7528\u9879\u76EE\u5165\u53E3</span></span>
<span class="line"><span style="color:#A6ACCD;">  entries</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">map</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">entry</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">build</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">absWorkingDir</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> process</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">cwd</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// \u6CE8\u610F\u8FD9\u4E2A\u53C2\u6570</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">write</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">false</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">entryPoints</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [entry]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">bundle</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">format</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">esm</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">logLevel</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">error</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#F07178;">plugins</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span><span style="color:#89DDFF;">...</span><span style="color:#A6ACCD;">plugins</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> plugin]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">      </span><span style="color:#89DDFF;">...</span><span style="color:#A6ACCD;">esbuildOptions</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  )</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><p>\u5176\u4E2D\u4F20\u5165\u7684 <code>write</code> \u8BBE\u5B9A\u4E3A <code>false</code> \uFF0C\u8868\u793A\u4EA7\u7269\u4E0D\u7528\u5199\u5165\u78C1\u76D8\uFF0C\u8FD9\u6837\u5927\u5927\u8282\u7701\u4E86\u78C1\u76D8 I / O \u7684\u65F6\u95F4\uFF0C\u8FD9\u4E5F\u662F\u4F9D\u8D56\u626B\u63CF\u5F80\u5F80\u6BD4\u4F9D\u8D56\u6253\u5305\u5FEB\u5F88\u591A\u7684\u539F\u56E0\u4E4B\u4E00\u3002</p><p>\u63A5\u4E0B\u6765\u8F93\u51FA\u9884\u6253\u5305\u4FE1\u606F\uFF1A</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki"><code><span class="line"><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">asCommand) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">newDeps</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">logger</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">info</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">chalk</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">greenBright</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">Pre-bundling dependencies:</span><span style="color:#A6ACCD;">\\n</span><span style="color:#C3E88D;">  </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">depsString</span><span style="color:#89DDFF;">}\`</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    )</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">logger</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">info</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">(this will be run only when your dependencies or config have changed)</span><span style="color:#89DDFF;">\`</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    )</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">else</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">logger</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">info</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">chalk</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">greenBright</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">Optimizing dependencies:</span><span style="color:#A6ACCD;">\\n</span><span style="color:#C3E88D;">  </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">depsString</span><span style="color:#89DDFF;">}\`</span><span style="color:#F07178;">))</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u7B2C\u4E00\u6B21\u542F\u52A8\u65F6\uFF0C\u4F1A\u8F93\u51FA\u9884\u6784\u5EFA\u76F8\u5173\u7684 log \u4FE1\u606F\uFF0C\u8FD9\u4E9B\u4FE1\u606F\u90FD\u662F\u901A\u8FC7\u4F9D\u8D56\u626B\u63CF\u9636\u6BB5\u6536\u96C6\u7684\uFF0C\u6B64\u65F6\u8FD8\u5E76\u672A\u5F00\u59CB\u771F\u6B63\u7684\u4F9D\u8D56\u6253\u5305\u8FC7\u7A0B\u3002</p><p>\u4E3A\u4EC0\u4E48\u5BF9\u9879\u76EE\u5165\u53E3\u6253\u5305\u4E00\u6B21\u5C31\u6536\u96C6\u5230\u6240\u6709\u4F9D\u8D56\u4FE1\u606F\u7684\u539F\u56E0\uFF1A<code>esbuildScanPlugin</code> \u8FD9\u4E2A\u51FD\u6570\u521B\u5EFA <code>scan \u63D2\u4EF6</code>\u65F6\uFF0C\u63A5\u6536\u4E86 <code>deps</code> \u5BF9\u8C61\u6700\u4E3A\u5165\u53C2\uFF0C\u8FD9\u4E2A\u5BF9\u8C61\u7684\u4F5C\u7528\u662F\u5728 <code>scan \u63D2\u4EF6</code>\u91CC\u89E3\u6790\u5404\u79CD import \u8BED\u53E5\uFF0C\u6700\u7EC8\u901A\u8FC7\u5B83\u6765\u8BB0\u5F55\u4F9D\u8D56\u4FE1\u606F\u3002</p><h3 id="\u4F9D\u8D56\u6253\u5305" tabindex="-1">\u4F9D\u8D56\u6253\u5305 <a class="header-anchor" href="#\u4F9D\u8D56\u6253\u5305" aria-hidden="true">#</a></h3><p>\u6536\u96C6\u5B8C\u4F9D\u8D56\u540E\uFF0C\u6B63\u5F0F\u8FDB\u5165\u4F9D\u8D56\u6253\u5305\u9636\u6BB5\u3002</p><p>\u8FD9\u91CC\u8C03\u7528 Ebuild \u8FDB\u884C\u6253\u5305\u5E76\u5199\u5165\u4EA7\u7269\u5230\u78C1\u76D8\u4E2D\uFF0C\u5173\u952E\u4EE3\u7801\u5982\u4E0B\uFF1A</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> result </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">await</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">build</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">absWorkingDir</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> process</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">cwd</span><span style="color:#A6ACCD;">()</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u6240\u6709\u4F9D\u8D56\u7684 id \u6570\u7EC4\uFF0C\u5728\u63D2\u4EF6\u4E2D\u4F1A\u8F6C\u6362\u4E3A\u771F\u5B9E\u7684\u8DEF\u5F84</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">entryPoints</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> Object</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">keys</span><span style="color:#A6ACCD;">(flatIdDeps)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">bundle</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">format</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">esm</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">target</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> config</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">build</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">target </span><span style="color:#89DDFF;">||</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">undefined,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">external</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> config</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">optimizeDeps</span><span style="color:#89DDFF;">?.</span><span style="color:#A6ACCD;">exclude</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">logLevel</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">error</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">splitting</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">sourcemap</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">outdir</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> cacheDir</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">ignoreAnnotations</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">metafile</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  define</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">plugins</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> [</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">...</span><span style="color:#A6ACCD;">plugins</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u9884\u6784\u5EFA\u4E13\u7528\u7684\u63D2\u4EF6</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#82AAFF;">esbuildDepPlugin</span><span style="color:#A6ACCD;">(flatIdDeps</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> flatIdToExports</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> config</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> ssr)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  ]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">...</span><span style="color:#A6ACCD;">esbuildOptions</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#676E95;">// \u6253\u5305\u5143\u4FE1\u606F\uFF0C\u540E\u7EED\u4F1A\u6839\u636E\u8FD9\u4EFD\u4FE1\u606F\u751F\u6210 _metadata.json</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> meta </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> result</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">metafile</span><span style="color:#89DDFF;">!</span></span>
<span class="line"></span></code></pre></div><h3 id="\u5143\u4FE1\u606F\u5199\u5165\u78C1\u76D8" tabindex="-1">\u5143\u4FE1\u606F\u5199\u5165\u78C1\u76D8 <a class="header-anchor" href="#\u5143\u4FE1\u606F\u5199\u5165\u78C1\u76D8" aria-hidden="true">#</a></h3><p>\u5728\u6253\u5305\u5B8C\u6210\u540E\uFF0CVite \u4F1A\u62FF\u5230 Esbuild \u6784\u5EFA\u7684\u5143\u4FE1\u606F\uFF0C\u5C31\u662F\u4E0A\u9762\u4EE3\u7801\u4E2D\u7684 <code>meta</code> \u5BF9\u8C61\uFF0C\u7136\u540E\u5C06\u5143\u4FE1\u606F\u4FDD\u5B58\u5230 <code>_metadata.json</code> \u6587\u4EF6\u4E2D\uFF1A</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> data</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">DepOptimizationMetadata</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">hash</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> mainHash</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">browserHash</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> mainHash</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">optimized</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{},</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#676E95;">// \u7701\u7565\u4E2D\u95F4\u7684\u4EE3\u7801</span></span>
<span class="line"><span style="color:#89DDFF;">for</span><span style="color:#A6ACCD;"> (</span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> id </span><span style="color:#89DDFF;">in</span><span style="color:#A6ACCD;"> deps) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">entry</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">deps</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">id</span><span style="color:#F07178;">]</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">data</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">optimized</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">id</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    file</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">normalizePath</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">resolve</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">cacheDir</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">flattenId</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">id</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">.js</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">))</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    src</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">entry</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u5224\u65AD\u662F\u5426\u9700\u8981\u8F6C\u6362\u6210 ESM \u683C\u5F0F\uFF0C\u540E\u9762\u4F1A\u4ECB\u7ECD</span></span>
<span class="line"><span style="color:#F07178;">    needsInterop</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">needsInterop</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">idToExports</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">id</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">meta</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">outputs</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">cacheDirOutputPath</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    )</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#676E95;">// \u5143\u4FE1\u606F\u5199\u78C1\u76D8</span></span>
<span class="line"><span style="color:#82AAFF;">writeFile</span><span style="color:#A6ACCD;">(dataPath</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> JSON</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">stringify</span><span style="color:#A6ACCD;">(data</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">null,</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">2</span><span style="color:#A6ACCD;">))</span></span>
<span class="line"></span></code></pre></div><h2 id="\u4F9D\u8D56\u626B\u63CF-1" tabindex="-1">\u4F9D\u8D56\u626B\u63CF <a class="header-anchor" href="#\u4F9D\u8D56\u626B\u63CF-1" aria-hidden="true">#</a></h2><h3 id="\u83B7\u53D6\u5165\u53E3" tabindex="-1">\u83B7\u53D6\u5165\u53E3 <a class="header-anchor" href="#\u83B7\u53D6\u5165\u53E3" aria-hidden="true">#</a></h3><p>\u9996\u5148\u5173\u6CE8 <code>scanImports</code> \u7684\u5B9E\u73B0\u3002</p><p>\u8FDB\u884C\u4F9D\u8D56\u626B\u63CF\u4E4B\u524D\uFF0C\u9700\u8981\u627E\u5230\u5165\u53E3\u6587\u4EF6\uFF0C\u4F46\u5165\u53E3\u6587\u4EF6\u53EF\u80FD\u5B58\u5728\u4E8E\u591A\u4E2A\u914D\u7F6E\u5F53\u4E2D\uFF0C\u6BD4\u5982 <code>optimizeDeps.entries</code> \u548C <code>build.rollupOptions.input</code> \uFF0C\u540C\u65F6\u9700\u8981\u8003\u8651\u6570\u7EC4\u548C\u5BF9\u8C61\u7684\u60C5\u51B5\uFF0C\u4F46\u53EF\u80FD\u7528\u6237\u6CA1\u6709\u914D\u7F6E\uFF0C\u9700\u8981\u81EA\u52A8\u63A2\u6D4B\u5165\u53E3\u6587\u4EF6\uFF1A</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> explicitEntryPatterns </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> config</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">optimizeDeps</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">entries</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> buildInput </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> config</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">build</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">rollupOptions</span><span style="color:#89DDFF;">?.</span><span style="color:#A6ACCD;">input</span></span>
<span class="line"><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> (explicitEntryPatterns) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u5148\u4ECE optimizeDeps.entries \u5BFB\u627E\u5165\u53E3\uFF0C\u652F\u6301 glob \u8BED\u6CD5</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">entries</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">globEntries</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">explicitEntryPatterns</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">config</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">else</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> (buildInput) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u5176\u6B21\u4ECE build.rollupOptions.input \u914D\u7F6E\u4E2D\u5BFB\u627E\uFF0C\u6CE8\u610F\u9700\u8981\u8003\u8651\u6570\u7EC4\u548C\u5BF9\u8C61\u7684\u60C5\u51B5</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">resolvePath</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">p</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">resolve</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">config</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">root</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">p</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">typeof</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">buildInput</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">string</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">entries</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> [</span><span style="color:#82AAFF;">resolvePath</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">buildInput</span><span style="color:#F07178;">)]</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">Array</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">isArray</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">buildInput</span><span style="color:#F07178;">)) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">entries</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">buildInput</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">map</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">resolvePath</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#82AAFF;">isObject</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">buildInput</span><span style="color:#F07178;">)) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">entries</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">Object</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">values</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">buildInput</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">map</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">resolvePath</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">throw</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">Error</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">invalid rollupOptions.input value.</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">else</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u515C\u5E95\u903B\u8F91\uFF0C\u5982\u679C\u7528\u6237\u6CA1\u6709\u8FDB\u884C\u4E0A\u8FF0\u914D\u7F6E\uFF0C\u5219\u81EA\u52A8\u4ECE\u6839\u76EE\u5F55\u5F00\u59CB\u5BFB\u627E</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">entries</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">globEntries</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">**/*.html</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">config</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p><code>globEntries</code> \u65B9\u6CD5\u901A\u8FC7 <code>fast-glob</code> \u5E93\u4ECE\u9879\u76EE\u6839\u76EE\u5F55\u626B\u63CF\u6587\u4EF6\u3002</p><p>\u63A5\u4E0B\u6765\uFF0C\u9700\u8981\u8003\u8651\u5165\u53E3\u6587\u4EF6\u7C7B\u578B\uFF0C\u4E00\u822C\u60C5\u51B5\u4E0B\u5165\u53E3\u9700\u8981\u662F JS \u6216 TS \u6587\u4EF6\uFF0C\u4F46\u5B9E\u9645\u4E0A\uFF0C\u50CF HTML \u3001Vue \u5355\u6587\u4EF6\u7EC4\u4EF6\u7B49\u4E5F\u9700\u8981\u652F\u6301\uFF0C\u56E0\u4E3A\u5728\u8FD9\u4E9B\u6587\u4EF6\u4E2D\u4ECD\u7136\u53EF\u4EE5\u5305\u542B script \u6807\u7B7E\u7684\u5185\u5BB9\uFF0C\u4ECE\u800C\u641C\u96C6\u5230\u4F9D\u8D56\u4FE1\u606F\u3002</p><p>\u5728\u6E90\u7801\u4E2D\uFF0C\u540C\u65F6\u5BF9 <code>html</code> \u3001<code>vue</code>\u3001<code>svelte</code>\u3001<code>astro</code> ( \u4E00\u79CD\u65B0\u5174\u7684\u7C7B HTML \u8BED\u6CD5 ) \u56DB\u79CD\u540E\u7F00\u7684\u5165\u53E3\u6587\u4EF6\u8FDB\u884C\u89E3\u6790\uFF0C\u5177\u4F53\u7684\u89E3\u6790\u8FC7\u7A0B\u5728\u4F9D\u8D56\u626B\u63CF\u9636\u6BB5\u7684 Esbuild \u63D2\u4EF6\u4E2D\u5F97\u4EE5\u5B9E\u73B0\u3002</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> htmlTypesRE </span><span style="color:#89DDFF;">=</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">/</span><span style="color:#C3E88D;">.</span><span style="color:#89DDFF;">(</span><span style="color:#C3E88D;">html</span><span style="color:#89DDFF;">|</span><span style="color:#C3E88D;">vue</span><span style="color:#89DDFF;">|</span><span style="color:#C3E88D;">svelte</span><span style="color:#89DDFF;">|</span><span style="color:#C3E88D;">astro</span><span style="color:#89DDFF;">)</span><span style="color:#89DDFF;">$</span><span style="color:#89DDFF;">/</span></span>
<span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">esbuildScanPlugin</span><span style="color:#89DDFF;">(</span><span style="color:#676E95;">/* \u4E00\u4E9B\u5165\u53C2 */</span><span style="color:#89DDFF;">):</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Plugin</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u521D\u59CB\u5316\u4E00\u4E9B\u53D8\u91CF</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u8FD4\u56DE\u4E00\u4E2A Esbuild \u63D2\u4EF6</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    name</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">vite:dep-scan</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    setup</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">build</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// \u6807\u8BB0\u300C\u7C7B HTML\u300D\u6587\u4EF6\u7684 namespace</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">build</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onResolve</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> filter</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">htmlTypesRE</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">},</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">async</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">({</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">path</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">importer</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">})</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">          path</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">resolve</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">path</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">importer</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">          namespace</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">html</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">build</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onLoad</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> filter</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">htmlTypesRE</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> namespace</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">html</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#C792EA;">async</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">({</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">path</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">})</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">          </span><span style="color:#676E95;">// \u89E3\u6790\u300C\u7C7B HTML\u300D\u6587\u4EF6</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">      )</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u4EE5 HTML \u6587\u4EF6\u7684\u89E3\u6790\u4E3A\u4F8B\uFF0C\u5728\u63D2\u4EF6\u4E2D\u4F1A\u626B\u63CF\u51FA\u6240\u6709\u5E26\u6709 <code>type=&quot;module&quot;</code> \u7684 script \u6807\u7B7E\uFF0C\u5BF9\u4E8E\u542B\u6709 src \u7684 script \u6807\u7B7E\u6539\u5199\u4E3A\u4E00\u4E2A import \u8BED\u53E5\uFF0C\u5BF9\u4E8E\u542B\u6709\u5177\u4F53\u5185\u5BB9\u7684 script \uFF0C\u5219\u62BD\u79BB\u51FA\u5176\u4E2D\u7684\u811A\u672C\u5185\u5BB9\uFF0C\u6700\u540E\u5C06\u6240\u6709\u7684 script \u5185\u5BB9\u62FC\u63A5\u6210\u4E00\u6BB5 JS \u4EE3\u7801\u3002</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> scriptModuleRE </span><span style="color:#89DDFF;">=</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">(&lt;</span><span style="color:#FFCB6B;">script</span><span style="color:#A6ACCD;">\\</span><span style="color:#FFCB6B;">b</span><span style="color:#A6ACCD;">[^&gt;]*</span><span style="color:#FFCB6B;">type</span><span style="color:#A6ACCD;">\\</span><span style="color:#FFCB6B;">s</span><span style="color:#A6ACCD;">*=\\</span><span style="color:#FFCB6B;">s</span><span style="color:#A6ACCD;">*(</span><span style="color:#89DDFF;">?:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">module</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">|</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">module</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)[^&gt;]*&gt;)(</span><span style="color:#89DDFF;">.*?</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">&lt;</span><span style="color:#89DDFF;">/</span><span style="color:#C3E88D;">script&gt;</span><span style="color:#89DDFF;">/</span><span style="color:#F78C6C;">gims</span></span>
<span class="line"><span style="color:#A6ACCD;">export const scriptRE </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">(&lt;</span><span style="color:#FFCB6B;">script</span><span style="color:#A6ACCD;">\\</span><span style="color:#FFCB6B;">b</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">?:</span><span style="color:#A6ACCD;">\\</span><span style="color:#FFCB6B;">s</span><span style="color:#A6ACCD;">[^&gt;]*&gt;</span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">&gt;))(.*</span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">/</span><span style="color:#FFCB6B;">script</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">/</span><span style="color:#FFCB6B;">gims</span></span>
<span class="line"><span style="color:#FFCB6B;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">const</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">commentRE</span><span style="color:#A6ACCD;"> = /</span><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">!--(.</span><span style="color:#89DDFF;">|</span><span style="color:#A6ACCD;">[\\</span><span style="color:#FFCB6B;">r</span><span style="color:#A6ACCD;">\\</span><span style="color:#FFCB6B;">n</span><span style="color:#A6ACCD;">])*</span><span style="color:#89DDFF;">?</span><span style="color:#A6ACCD;">--</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">/</span></span>
<span class="line"><span style="color:#FFCB6B;">const</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">srcRE</span><span style="color:#A6ACCD;"> = /\\</span><span style="color:#FFCB6B;">bsrc</span><span style="color:#A6ACCD;">\\</span><span style="color:#FFCB6B;">s</span><span style="color:#A6ACCD;">*=\\</span><span style="color:#FFCB6B;">s</span><span style="color:#A6ACCD;">*(</span><span style="color:#89DDFF;">?:</span><span style="color:#A6ACCD;"> ([^ ]+) </span><span style="color:#89DDFF;">|</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">([^</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">]+)</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">|([^</span><span style="color:#A6ACCD;">\\s</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> &gt;]</span><span style="color:#89DDFF;">+</span><span style="color:#A6ACCD;">))</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">im</span></span>
<span class="line"><span style="color:#A6ACCD;">const typeRE </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">/</span><span style="color:#89DDFF;">\\b</span><span style="color:#C3E88D;">type\\s</span><span style="color:#89DDFF;">*</span><span style="color:#C3E88D;">=\\s</span><span style="color:#89DDFF;">*(?:</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">([^</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">]+)</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">|</span><span style="color:#C3E88D;">&#39;</span><span style="color:#89DDFF;">([^</span><span style="color:#C3E88D;">&#39;</span><span style="color:#89DDFF;">]+)</span><span style="color:#C3E88D;">&#39;</span><span style="color:#89DDFF;">|([^</span><span style="color:#C3E88D;">\\s&#39; &gt;</span><span style="color:#89DDFF;">]+))/</span><span style="color:#F78C6C;">im</span></span>
<span class="line"><span style="color:#A6ACCD;">const langRE </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">/</span><span style="color:#89DDFF;">\\b</span><span style="color:#C3E88D;">lang\\s</span><span style="color:#89DDFF;">*</span><span style="color:#C3E88D;">=\\s</span><span style="color:#89DDFF;">*(?:</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">([^</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">]+)</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">|</span><span style="color:#C3E88D;">&#39;</span><span style="color:#89DDFF;">([^</span><span style="color:#C3E88D;">&#39;</span><span style="color:#89DDFF;">]+)</span><span style="color:#C3E88D;">&#39;</span><span style="color:#89DDFF;">|([^</span><span style="color:#C3E88D;">\\s&#39; &gt;</span><span style="color:#89DDFF;">]+))/</span><span style="color:#F78C6C;">im</span></span>
<span class="line"><span style="color:#676E95;">// scan \u63D2\u4EF6 setup \u65B9\u6CD5\u5185\u90E8\u5B9E\u73B0</span></span>
<span class="line"><span style="color:#A6ACCD;">build</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onLoad</span><span style="color:#A6ACCD;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">filter</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> htmlTypesRE</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">namespace</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">html</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">({</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">path</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">})</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">raw</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">fs</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">readFileSync</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">path</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">utf-8</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u53BB\u6389\u6CE8\u91CA\u5185\u5BB9\uFF0C\u9632\u6B62\u5E72\u6270\u89E3\u6790\u8FC7\u7A0B</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">raw</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">raw</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">replace</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">commentRE</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">&lt;!----&gt;</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">isHtml</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">endsWith</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">.html</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// HTML \u60C5\u51B5\u4E0B\u4F1A\u5BFB\u627E type \u4E3A module \u7684 script</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u6B63\u5219\uFF1A/(&lt;script\\b[^&gt;]*type\\s*=\\s*(?: module |&#39;module&#39;)[^&gt;]*&gt;)(.*?)&lt;/script&gt;/gims</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">regex</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">isHtml</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">?</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">scriptModuleRE</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">scriptRE</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">regex</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">lastIndex</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">js</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;&#39;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">loader</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">Loader</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">js</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">match</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">RegExpExecArray</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">|</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">null</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u6B63\u5F0F\u5F00\u59CB\u89E3\u6790</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">while</span><span style="color:#F07178;"> ((</span><span style="color:#A6ACCD;">match</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">regex</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">exec</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">raw</span><span style="color:#F07178;">))) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// \u7B2C\u4E00\u6B21: openTag \u4E3A &lt;script type= module  src= /src/main.ts &gt;, \u65E0 content</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// \u7B2C\u4E8C\u6B21: openTag \u4E3A &lt;script type= module &gt;\uFF0C\u6709 content</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">[,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">openTag</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">content</span><span style="color:#89DDFF;">]</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">match</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">typeMatch</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">openTag</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">match</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">typeRE</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">type</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">typeMatch</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">typeMatch</span><span style="color:#F07178;">[</span><span style="color:#F78C6C;">1</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">||</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">typeMatch</span><span style="color:#F07178;">[</span><span style="color:#F78C6C;">2</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">||</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">typeMatch</span><span style="color:#F07178;">[</span><span style="color:#F78C6C;">3</span><span style="color:#F07178;">])</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">langMatch</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">openTag</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">match</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">langRE</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">lang</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">langMatch</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">langMatch</span><span style="color:#F07178;">[</span><span style="color:#F78C6C;">1</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">||</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">langMatch</span><span style="color:#F07178;">[</span><span style="color:#F78C6C;">2</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">||</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">langMatch</span><span style="color:#F07178;">[</span><span style="color:#F78C6C;">3</span><span style="color:#F07178;">])</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">lang</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">ts</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">||</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">lang</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">tsx</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">||</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">lang</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">jsx</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;">// \u6307\u5B9A esbuild \u7684 loader</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">loader</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">lang</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">srcMatch</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">openTag</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">match</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">srcRE</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// \u6839\u636E\u6709\u65E0 src \u5C5E\u6027\u6765\u8FDB\u884C\u4E0D\u540C\u7684\u5904\u7406</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">srcMatch</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">src</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">srcMatch</span><span style="color:#F07178;">[</span><span style="color:#F78C6C;">1</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">||</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">srcMatch</span><span style="color:#F07178;">[</span><span style="color:#F78C6C;">2</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">||</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">srcMatch</span><span style="color:#F07178;">[</span><span style="color:#F78C6C;">3</span><span style="color:#F07178;">]</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">js</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">import </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">JSON</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">stringify</span><span style="color:#A6ACCD;">(src)</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">\\n</span><span style="color:#89DDFF;">\`</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">content</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">trim</span><span style="color:#F07178;">()) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">js</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">content</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">\\n</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">loader</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    contents</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">js</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">)</span></span>
<span class="line"></span></code></pre></div><p>\u8FD9\u91CC\u5BF9\u6E90\u7801\u505A\u4E86\u4E00\u5B9A\u7684\u7CBE\u7B80\uFF0C\u7701\u7565\u4E86 <code>.vue</code> \u3001<code>.svelte</code> \u548C <code>i<wbr>mport.meta.glob</code> \u8BED\u6CD5\u7684\u5904\u7406\uFF0C\u4F46\u4E0D\u5F71\u54CD\u6574\u4F53\u7684\u5B9E\u73B0\u601D\u8DEF\uFF0C\u8FD9\u91CC\u8BF4\u660E\u7684\u662F\u5373\u4F7F\u662F HTML \u6216\u8005\u7C7B\u4F3C\u7C7B\u578B\u7684\u6587\u4EF6\uFF0C\u4E5F\u80FD\u4F5C\u4E3A Esbuild \u9884\u6784\u5EFA\u5165\u53E3\u6765\u8FDB\u884C\u89E3\u6790\u3002</p><h3 id="\u8BB0\u5F55\u4F9D\u8D56" tabindex="-1">\u8BB0\u5F55\u4F9D\u8D56 <a class="header-anchor" href="#\u8BB0\u5F55\u4F9D\u8D56" aria-hidden="true">#</a></h3><p>Vite \u4E2D\u4F1A\u628A <code>bare import</code> \u7684\u8DEF\u5F84\u5F53\u4F5C\u4F9D\u8D56\u8DEF\u5F84\uFF0C<code>bare import</code> \u5C31\u662F\u76F4\u63A5\u5F15\u5165\u4E00\u4E2A\u5305\u540D\uFF1A</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki"><code><span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> React </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">react</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span></code></pre></div><p>\u800C <code>.</code> \u5F00\u5934\u7684\u76F8\u5BF9\u8DEF\u5F84\u6216\u8005\u4EE5 <code>/</code> \u5F00\u5934\u7684\u7EDD\u5BF9\u8DEF\u5F84\u90FD\u4E0D\u80FD\u7B97 <code>bare import</code> \uFF1A</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki"><code><span class="line"><span style="color:#676E95;">// \u4EE5\u4E0B\u90FD\u4E0D\u662F bare import</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> React </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">../node_modules/react/index.js</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> React </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">/User/sanyuan/vite-project/node_modules/react/index.js</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span></code></pre></div><p>\u89E3\u6790 <code>bare import</code> \uFF0C\u8BB0\u5F55\u4F9D\u8D56\u7684\u903B\u8F91\u4F9D\u7136\u5728 scan \u63D2\u4EF6\u4E2D\uFF1A</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki"><code><span class="line"><span style="color:#A6ACCD;">build</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onResolve</span><span style="color:#A6ACCD;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// avoid matching windows volume</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">filter</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">/</span><span style="color:#89DDFF;">^</span><span style="color:#89DDFF;">[</span><span style="color:#C3E88D;">\\w@</span><span style="color:#89DDFF;">][^</span><span style="color:#C3E88D;">:</span><span style="color:#89DDFF;">]/</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">({</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">path</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">importer</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">})</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u5982\u679C\u5728 optimizeDeps.exclude \u5217\u8868\u6216\u8005\u5DF2\u7ECF\u8BB0\u5F55\u8FC7\u4E86\uFF0C\u5219\u5C06\u5176 externalize (\u6392\u9664)\uFF0C\u76F4\u63A5 return</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u63A5\u4E0B\u6765\u89E3\u6790\u8DEF\u5F84\uFF0C\u5185\u90E8\u8C03\u7528\u5404\u4E2A\u63D2\u4EF6\u7684 resolveId \u65B9\u6CD5\u8FDB\u884C\u89E3\u6790</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">resolved</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">await</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">resolve</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">importer</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">resolved</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// \u5224\u65AD\u662F\u5426\u5E94\u8BE5 externalize\uFF0C\u4E0B\u4E2A\u90E8\u5206\u8BE6\u7EC6\u62C6\u89E3</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#82AAFF;">shouldExternalizeDep</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">resolved</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">id</span><span style="color:#F07178;">)) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">externalUnlessEntry</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> path</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">id</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">resolved</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">includes</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">node_modules</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">||</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">include</span><span style="color:#89DDFF;">?.</span><span style="color:#82AAFF;">includes</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">id</span><span style="color:#F07178;">)) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;">// \u5982\u679C resolved \u4E3A js \u6216 ts \u6587\u4EF6</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">OPTIMIZABLE_ENTRY_RE</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">test</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">resolved</span><span style="color:#F07178;">)) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">          </span><span style="color:#676E95;">// \u6CE8\u610F\u4E86! \u73B0\u5728\u5C06\u5176\u6B63\u5F0F\u5730\u8BB0\u5F55\u5728\u4F9D\u8D56\u8868\u4E2D</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#A6ACCD;">depImports</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">id</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">resolved</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;">// \u8FDB\u884C externalize\uFF0C\u56E0\u4E3A\u8FD9\u91CC\u53EA\u7528\u626B\u63CF\u51FA\u4F9D\u8D56\u5373\u53EF\uFF0C\u4E0D\u9700\u8981\u8FDB\u884C\u6253\u5305\uFF0C\u5177\u4F53\u5B9E\u73B0\u540E\u9762\u7684\u90E8\u5206\u4F1A\u8BB2\u5230</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">externalUnlessEntry</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> path</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">id</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;">// resolved \u4E3A \u300C\u7C7B html\u300D \u6587\u4EF6\uFF0C\u5219\u6807\u8BB0\u4E0A &#39;html&#39; \u7684 namespace</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">namespace</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">htmlTypesRE</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">test</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">resolved</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">?</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">html</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">undefined</span></span>
<span class="line"><span style="color:#89DDFF;">        </span><span style="color:#676E95;">// linked package, keep crawling</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">          path</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">resolve</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">resolved</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">          </span><span style="color:#A6ACCD;">namespace</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// \u6CA1\u6709\u89E3\u6790\u5230\u8DEF\u5F84\uFF0C\u8BB0\u5F55\u5230 missing \u8868\u4E2D\uFF0C\u540E\u7EED\u4F1A\u68C0\u6D4B\u8FD9\u5F20\u8868\uFF0C\u663E\u793A\u76F8\u5173\u8DEF\u5F84\u672A\u627E\u5230\u7684\u62A5\u9519</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">missing</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">id</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">normalizePath</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">importer</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><p>\u5176\u4E2D\u8C03\u7528\u5230\u4E86 <code>resolve</code> \uFF0C\u4E5F\u5C31\u662F\u8DEF\u5F84\u89E3\u6790\u7684\u903B\u8F91\uFF0C\u8FD9\u91CC\u9762\u5B9E\u9645\u4E0A\u4F1A\u8C03\u7528\u5404\u4E2A\u63D2\u4EF6\u7684 <code>resolvedId</code> \u65B9\u6CD5\u8FDB\u884C\u8DEF\u5F84\u89E3\u6790\uFF1A</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> resolve </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">async</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">importer</span><span style="color:#89DDFF;">?:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u901A\u8FC7 seen \u5BF9\u8C61\u8FDB\u884C\u8DEF\u5F84\u7F13\u5B58</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">key</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">id</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">importer</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">dirname</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">importer</span><span style="color:#F07178;">))</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">seen</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">has</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">key</span><span style="color:#F07178;">)) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">seen</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">get</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">key</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u8C03\u7528\u63D2\u4EF6\u5BB9\u5668\u7684 resolveId</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u5173\u4E8E\u63D2\u4EF6\u5BB9\u5668\u4E0B\u4E00\u8282\u4F1A\u8BE6\u7EC6\u4ECB\u7ECD\uFF0C\u8FD9\u91CC\u4F60\u76F4\u63A5\u7406\u89E3\u4E3A\u8C03\u7528\u5404\u4E2A\u63D2\u4EF6\u7684 resolveId \u65B9\u6CD5\u89E3\u6790\u8DEF\u5F84\u5373\u53EF</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">resolved</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">await</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">container</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">resolveId</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">importer</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">normalizePath</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">importer</span><span style="color:#F07178;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">  )</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">res</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">resolved</span><span style="color:#89DDFF;">?.</span><span style="color:#A6ACCD;">id</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">seen</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">set</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">key</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">res</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">res</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h3 id="external-\u89C4\u5219" tabindex="-1">external \u89C4\u5219 <a class="header-anchor" href="#external-\u89C4\u5219" aria-hidden="true">#</a></h3><p>\u4E0A\u9762\u5206\u6790\u4E86\u5728 Esbuild \u63D2\u4EF6\u4E2D\u5982\u4F55\u9488\u5BF9 <code>bare import</code> \u8BB0\u5F55\u4F9D\u8D56\uFF0C\u5728\u8BB0\u5F55\u8FC7\u7A0B\u4E2D\u9700\u8981\u51B3\u5B9A\u54EA\u4E9B\u8DEF\u5F84\u5E94\u8BE5\u88AB\u6392\u9664\u3001\u4E0D\u5E94\u8BE5\u88AB\u8BB0\u5F55\u6216\u8005\u4E0D\u5E94\u8BE5\u88AB Esbuild \u89E3\u6790\u3002\u8FD9\u5C31\u662F external \u89C4\u5219\u7684\u6982\u5FF5\u3002</p><p>external \u7684\u8DEF\u5F84\u5206\u4E3A\u4E24\u7C7B\uFF1A\u8D44\u6E90\u578B\u548C\u6A21\u5757\u578B\u3002</p><p>\u5BF9\u4E8E\u8D44\u6E90\u578B\u7684\u8DEF\u5F84\uFF0C\u4E00\u822C\u662F\u76F4\u63A5\u6392\u9664\uFF0C\u5728\u63D2\u4EF6\u4E2D\u7684\u5904\u7406\u65B9\u5F0F\u5982\u4E0B\uFF1A</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki"><code><span class="line"><span style="color:#676E95;">// data url\uFF0C\u76F4\u63A5\u6807\u8BB0 external: true\uFF0C\u4E0D\u8BA9 esbuild \u7EE7\u7EED\u5904\u7406</span></span>
<span class="line"><span style="color:#A6ACCD;">build</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onResolve</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">filter</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> dataUrlRE </span><span style="color:#89DDFF;">},</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">({</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">path</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">})</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  path</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">external</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">))</span></span>
<span class="line"><span style="color:#676E95;">// \u52A0\u4E86 ?worker \u6216\u8005 ?raw \u8FD9\u79CD query \u7684\u8D44\u6E90\u8DEF\u5F84\uFF0C\u76F4\u63A5 external</span></span>
<span class="line"><span style="color:#A6ACCD;">build</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onResolve</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">filter</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> SPECIAL_QUERY_RE </span><span style="color:#89DDFF;">},</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">({</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">path</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">})</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  path</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">external</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">))</span></span>
<span class="line"><span style="color:#676E95;">// css &amp; json</span></span>
<span class="line"><span style="color:#A6ACCD;">build</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onResolve</span><span style="color:#A6ACCD;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">filter</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">/</span><span style="color:#C3E88D;">.</span><span style="color:#89DDFF;">(</span><span style="color:#C3E88D;">css</span><span style="color:#89DDFF;">|</span><span style="color:#C3E88D;">less</span><span style="color:#89DDFF;">|</span><span style="color:#C3E88D;">sass</span><span style="color:#89DDFF;">|</span><span style="color:#C3E88D;">scss</span><span style="color:#89DDFF;">|</span><span style="color:#C3E88D;">styl</span><span style="color:#89DDFF;">|</span><span style="color:#C3E88D;">stylus</span><span style="color:#89DDFF;">|</span><span style="color:#C3E88D;">pcss</span><span style="color:#89DDFF;">|</span><span style="color:#C3E88D;">postcss</span><span style="color:#89DDFF;">|</span><span style="color:#C3E88D;">json</span><span style="color:#89DDFF;">)</span><span style="color:#89DDFF;">$</span><span style="color:#89DDFF;">/</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u975E entry \u5219\u76F4\u63A5\u6807\u8BB0 external</span></span>
<span class="line"><span style="color:#A6ACCD;">  externalUnlessEntry</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#676E95;">// Vite \u5185\u7F6E\u7684\u4E00\u4E9B\u8D44\u6E90\u7C7B\u578B\uFF0C\u6BD4\u5982 .png\u3001.wasm \u7B49\u7B49</span></span>
<span class="line"><span style="color:#A6ACCD;">build</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onResolve</span><span style="color:#A6ACCD;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">filter</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">RegExp</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">\`</span><span style="color:#A6ACCD;">\\.</span><span style="color:#C3E88D;">(</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">KNOWN_ASSET_TYPES</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">join</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">|</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;">)$</span><span style="color:#89DDFF;">\`</span><span style="color:#A6ACCD;">)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u975E entry \u5219\u76F4\u63A5\u6807\u8BB0 external</span></span>
<span class="line"><span style="color:#A6ACCD;">  externalUnlessEntry</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> externalUnlessEntry </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">({</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;">path</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">}:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#A6ACCD;"> </span><span style="color:#F07178;">path</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">})</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  path</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u975E entry \u5219\u6807\u8BB0 external</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">external</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">entries</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">includes</span><span style="color:#A6ACCD;">(path)</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><p>\u5BF9\u4E8E\u6A21\u5757\u578B\u7684\u8DEF\u5F84\uFF0C\u4E5F\u5C31\u662F\u5F53\u901A\u8FC7 <code>resolve</code> \u51FD\u6570\u89E3\u6790\u51FA\u4E00\u4E2A JS \u6A21\u5757\u7684\u8DEF\u5F84\uFF0C\u5728 <code>shouldExternalizeDep</code> \u4E2D\u5B9E\u73B0\uFF1A</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki"><code><span class="line"><span style="color:#89DDFF;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">shouldExternalizeDep</span><span style="color:#89DDFF;">(</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#A6ACCD;">resolvedId</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#A6ACCD;">rawId</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">):</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">boolean</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u89E3\u6790\u4E4B\u540E\u4E0D\u662F\u4E00\u4E2A\u7EDD\u5BF9\u8DEF\u5F84\uFF0C\u4E0D\u5728 esbuild \u4E2D\u8FDB\u884C\u52A0\u8F7D</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">isAbsolute</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">resolvedId</span><span style="color:#F07178;">)) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// 1. import \u8DEF\u5F84\u672C\u8EAB\u5C31\u662F\u4E00\u4E2A\u7EDD\u5BF9\u8DEF\u5F84</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// 2. \u865A\u62DF\u6A21\u5757(Rollup \u63D2\u4EF6\u4E2D\u7EA6\u5B9A\u865A\u62DF\u6A21\u5757\u4EE5\`\\0\`\u5F00\u5934)</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u90FD\u4E0D\u5728 esbuild \u4E2D\u8FDB\u884C\u52A0\u8F7D</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">resolvedId</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">===</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">rawId</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">||</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">resolvedId</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">includes</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">\\0</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u4E0D\u662F JS \u6216\u8005 \u7C7B HTML \u6587\u4EF6\uFF0C\u4E0D\u5728 esbuild \u4E2D\u8FDB\u884C\u52A0\u8F7D</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">JS_TYPES_RE</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">test</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">resolvedId</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">htmlTypesRE</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">test</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">resolvedId</span><span style="color:#F07178;">)) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">false</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h2 id="\u4F9D\u8D56\u6253\u5305-1" tabindex="-1">\u4F9D\u8D56\u6253\u5305 <a class="header-anchor" href="#\u4F9D\u8D56\u6253\u5305-1" aria-hidden="true">#</a></h2><h3 id="\u6241\u5E73\u5316\u4EA7\u7269\u6587\u4EF6\u7ED3\u6784" tabindex="-1">\u6241\u5E73\u5316\u4EA7\u7269\u6587\u4EF6\u7ED3\u6784 <a class="header-anchor" href="#\u6241\u5E73\u5316\u4EA7\u7269\u6587\u4EF6\u7ED3\u6784" aria-hidden="true">#</a></h3><p>\u4E00\u822C\u60C5\u51B5\u4E0B\uFF0CEsbuild \u8F93\u51FA\u5D4C\u5957\u7684\u4EA7\u7269\u76EE\u5F55\u7ED3\u6784\uFF0C\u6BD4\u5982 Vue \uFF0C\u5176\u4EA7\u7269\u5728 <code>dist/vue.runtime.esm-bundler.js</code> \u4E2D\uFF0C\u5728\u7ECF\u8FC7 Esbuild \u6B63\u5E38\u6253\u5305\u540E\uFF0C\u9884\u6784\u5EFA\u4EA7\u7269\u76EE\u5F55\u5982\u4E0B\uFF1A</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki"><code><span class="line"><span style="color:#A6ACCD;">node_modules/.vite</span></span>
<span class="line"><span style="color:#A6ACCD;">\u251C\u2500\u2500 _metadata.json</span></span>
<span class="line"><span style="color:#A6ACCD;">\u251C\u2500\u2500 vue</span></span>
<span class="line"><span style="color:#A6ACCD;">\u2502   \u2514\u2500\u2500 dist</span></span>
<span class="line"><span style="color:#A6ACCD;">\u2502       \u2514\u2500\u2500 vue.runtime.esm-bundler.js</span></span>
<span class="line"></span></code></pre></div><p>\u7531\u4E8E\u5404\u4E2A\u7B2C\u4E09\u65B9\u5305\u7684\u4EA7\u7269\u76EE\u5F55\u7ED3\u6784\u4E0D\u4E00\u81F4\uFF0C\u6DF1\u5C42\u6B21\u7684\u5D4C\u5957\u76EE\u5F55\u5BF9\u4E8E Vite \u7684\u8DEF\u5F84\u89E3\u6790\u589E\u52A0\u4E86\u9EBB\u70E6\u548C\u4E0D\u53EF\u63A7\u56E0\u7D20\u3002\u4E3A\u4E86\u89E3\u51B3\u5D4C\u5957\u76EE\u5F55\u5E26\u6765\u7684\u95EE\u9898\uFF0CVite \u505A\u4E86\u4E24\u4EF6\u4E8B\u8FBE\u5230\u6241\u5E73\u5316\u9884\u6784\u5EFA\u4EA7\u7269\u8F93\u51FA\uFF1A</p><ol><li>\u5D4C\u5957\u8DEF\u5F84\u6241\u5E73\u5316\uFF1A<code>/</code> \u88AB\u6362\u6210\u4E0B\u5212\u7EBF\uFF0C\u5982 <code>react/jsx-dev-runtime</code> \uFF0C\u88AB\u91CD\u5199\u4E3A <code>react_jsx-dev-runtime</code> \u3002</li><li>\u7528\u865A\u62DF\u6A21\u5757\u4EE3\u66FF\u771F\u5B9E\u6A21\u5757\uFF0C\u4F5C\u4E3A\u9884\u6253\u5305\u7684\u5165\u53E3\u3002</li></ol><p>\u5728 <code>optimizeDeps</code> \u51FD\u6570\u4E2D\uFF0C\u5728\u8FDB\u884C\u5B8C\u4F9D\u8D56\u626B\u63CF\u7684\u6B65\u9AA4\u540E\uFF0C\u4F1A\u6267\u884C\u8DEF\u5F84\u6241\u5E73\u5316\u64CD\u4F5C\uFF1A</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> flatIdDeps</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Record</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> idToExports</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Record</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">ExportsData</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> flatIdToExports</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Record</span><span style="color:#89DDFF;">&lt;</span><span style="color:#FFCB6B;">string</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">ExportsData</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{}</span></span>
<span class="line"><span style="color:#676E95;">// deps \u5373\u4E3A\u626B\u63CF\u540E\u7684\u4F9D\u8D56\u8868</span></span>
<span class="line"><span style="color:#676E95;">// \u5F62\u5982: {</span></span>
<span class="line"><span style="color:#676E95;">//    react :  /Users/sanyuan/vite-project/react/index.js  }</span></span>
<span class="line"><span style="color:#676E95;">//    react/jsx-dev-runtime :  /Users/sanyuan/vite-project/react/jsx-dev-runtime.js</span></span>
<span class="line"><span style="color:#676E95;">// }</span></span>
<span class="line"><span style="color:#89DDFF;">for</span><span style="color:#A6ACCD;"> (</span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> id </span><span style="color:#89DDFF;">in</span><span style="color:#A6ACCD;"> deps) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u6241\u5E73\u5316\u8DEF\u5F84\uFF0C\`react/jsx-dev-runtime\`\uFF0C\u88AB\u91CD\u5199\u4E3A\`react_jsx-dev-runtime\`\uFF1B</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">flatId</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">flattenId</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">id</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u586B\u5165 flatIdDeps \u8868\uFF0C\u8BB0\u5F55 flatId -&gt; \u771F\u5B9E\u8DEF\u5F84\u7684\u6620\u5C04\u5173\u7CFB</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">filePath</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> (</span><span style="color:#A6ACCD;">flatIdDeps</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">flatId</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">deps</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">id</span><span style="color:#F07178;">])</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">entryContent</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">fs</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">readFileSync</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">filePath</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">utf-8</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u540E\u7EED\u4EE3\u7801\u7701\u7565</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u5BF9\u4E8E\u865A\u62DF\u6A21\u5757\u7684\u5904\u7406\uFF0C\u5173\u6CE8 <code>esbuildDepPlugin</code> \u51FD\u6570\uFF1A</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki"><code><span class="line"><span style="color:#89DDFF;">export</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">esbuildDepPlugin</span><span style="color:#89DDFF;">(</span><span style="color:#676E95;">/* \u4E00\u4E9B\u4F20\u53C2 */</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u5B9A\u4E49\u8DEF\u5F84\u89E3\u6790\u7684\u65B9\u6CD5</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u8FD4\u56DE Esbuild \u63D2\u4EF6</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    name</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">vite:dep-pre-bundle</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">    set</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">build</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// bare import \u7684\u8DEF\u5F84</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">build</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onResolve</span><span style="color:#F07178;">(</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> filter</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">/</span><span style="color:#89DDFF;">^</span><span style="color:#89DDFF;">[</span><span style="color:#C3E88D;">\\w@</span><span style="color:#89DDFF;">][^</span><span style="color:#C3E88D;">:</span><span style="color:#89DDFF;">]/</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#C792EA;">async</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">({</span><span style="color:#F07178;"> path</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">id</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">importer</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">kind</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">})</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">          </span><span style="color:#676E95;">// \u5224\u65AD\u662F\u5426\u4E3A\u5165\u53E3\u6A21\u5757\uFF0C\u5982\u679C\u662F\uFF0C\u5219\u6807\u8BB0\u4E0A\`dep\`\u7684 namespace\uFF0C\u6210\u4E3A\u4E00\u4E2A\u865A\u62DF\u6A21\u5757</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">build</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onLoad</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> filter</span><span style="color:#89DDFF;">:</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">/</span><span style="color:#C3E88D;">.</span><span style="color:#89DDFF;">*/</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> namespace</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">dep</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">},</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">({</span><span style="color:#F07178;"> path</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">id</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">})</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">      </span><span style="color:#676E95;">// \u52A0\u8F7D\u865A\u62DF\u6A21\u5757</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  }</span></span>
<span class="line"><span style="color:#F07178;">}</span></span>
<span class="line"></span></code></pre></div><p>\u5982\u6B64\u4E00\u6765\uFF0CEsbuild \u4F1A\u5C06\u865A\u62DF\u6A21\u5757\u4F5C\u4E3A\u5165\u53E3\u8FDB\u884C\u6253\u5305\uFF0C\u6700\u540E\u7684\u4EA7\u7269\u76EE\u5F55\u4F1A\u53D8\u6210\u4E0B\u9762\u7684\u6241\u5E73\u7ED3\u6784\uFF1A</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki"><code><span class="line"><span style="color:#A6ACCD;">node_modules/.vite</span></span>
<span class="line"><span style="color:#A6ACCD;">\u251C\u2500\u2500 _metadata.json</span></span>
<span class="line"><span style="color:#A6ACCD;">\u251C\u2500\u2500 vue.js</span></span>
<span class="line"><span style="color:#A6ACCD;">\u251C\u2500\u2500 react.js</span></span>
<span class="line"><span style="color:#A6ACCD;">\u251C\u2500\u2500 react_jsx-dev-runtime.js</span></span>
<span class="line"></span></code></pre></div><h3 id="\u4EE3\u7406\u6A21\u5757\u52A0\u8F7D" tabindex="-1">\u4EE3\u7406\u6A21\u5757\u52A0\u8F7D <a class="header-anchor" href="#\u4EE3\u7406\u6A21\u5757\u52A0\u8F7D" aria-hidden="true">#</a></h3><p>\u865A\u62DF\u6A21\u5757\u4EE3\u66FF\u4E86\u771F\u5B9E\u6A21\u5757\u4F5C\u4E3A\u6253\u5305\u5165\u53E3\uFF0C\u6240\u4EE5\u4E5F\u53EF\u4EE5\u7406\u89E3\u4E3A\u4EE3\u7406\u6A21\u5757\u3002</p><p>\u4EE5 <code>import React from &quot;react&quot;</code> \u4E3A\u4F8B\uFF0CVite \u4F1A\u628A <code>react</code> \u6807\u8BB0\u4E3A <code>namespace</code> \u4E3A <code>dep</code> \u7684\u865A\u62DF\u6A21\u5757\uFF0C\u7136\u540E\u63A7\u5236 Esbuild \u7684\u52A0\u8F7D\u6D41\u7A0B\uFF0C\u5BF9\u4E8E\u771F\u5B9E\u6A21\u5757\u7684\u5185\u5BB9\u8FDB\u884C\u91CD\u65B0\u5BFC\u51FA\u3002</p><p>\u9996\u5148\u662F\uFF0C\u786E\u5B9A\u771F\u5B9E\u6A21\u5757\u7684\u8DEF\u5F84\uFF1A</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki"><code><span class="line"><span style="color:#676E95;">// \u771F\u5B9E\u6A21\u5757\u6240\u5728\u7684\u8DEF\u5F84\uFF0C\u62FF react \u6765\u8BF4\uFF0C\u5373\`node_modules/react/index.js\`</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> entryFile </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> qualified[id]</span></span>
<span class="line"><span style="color:#676E95;">// \u786E\u5B9A\u76F8\u5BF9\u8DEF\u5F84</span></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> relativePath </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">normalizePath</span><span style="color:#A6ACCD;">(path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">relative</span><span style="color:#A6ACCD;">(root</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> entryFile))</span></span>
<span class="line"><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> (</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">relativePath</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">startsWith</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;">&amp;&amp;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">relativePath</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">startsWith</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">../</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;">&amp;&amp;</span></span>
<span class="line"><span style="color:#A6ACCD;">  relativePath </span><span style="color:#89DDFF;">!==</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">.</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">relativePath</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">./</span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">relativePath</span><span style="color:#89DDFF;">}\`</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u786E\u5B9A\u8DEF\u5F84\u540E\uFF0C\u5BF9\u6A21\u5757\u7684\u5185\u5BB9\u8FDB\u884C\u91CD\u65B0\u5BFC\u51FA\uFF1A</p><ol><li>CJS</li><li>ESM</li></ol><p>\u5728 <code>optimizeDeps</code> \u4E2D\uFF0C\u5B9E\u9645\u4E0A\u5728\u8FDB\u884C\u771F\u6B63\u7684\u4F9D\u8D56\u6253\u5305\u4E4B\u524D\uFF0CVite \u4F1A\u8BFB\u53D6\u5404\u4E2A\u4F9D\u8D56\u7684\u5165\u53E3\u6587\u4EF6\uFF0C\u901A\u8FC7 <code>es-module-lexer</code> \u89E3\u6790\u5165\u53E3\u6587\u4EF6\u7684\u5185\u5BB9\u3002</p><p><code>es-module-lexer</code> \u662F\u4E00\u4E2A\u5728\u89E3\u6790 ES \u5BFC\u5165\u5BFC\u51FA\u8BED\u6CD5\u7684\u5E93\uFF0C\u5927\u81F4\u7528\u6CD5\u5982\u4E0B\uFF1A</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki"><code><span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">init</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">parse</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">es-module-lexer</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#676E95;">// \u7B49\u5F85\`es-module-lexer\`\u521D\u59CB\u5316\u5B8C\u6210</span></span>
<span class="line"><span style="color:#89DDFF;">await</span><span style="color:#A6ACCD;"> init</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> sourceStr </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\`</span></span>
<span class="line"><span style="color:#C3E88D;">  import moduleA from &#39;./a&#39;;</span></span>
<span class="line"><span style="color:#C3E88D;">  export * from &#39;b&#39;;</span></span>
<span class="line"><span style="color:#C3E88D;">  export const count = 1;</span></span>
<span class="line"><span style="color:#C3E88D;">  export default count;</span></span>
<span class="line"><span style="color:#89DDFF;">\`</span></span>
<span class="line"><span style="color:#676E95;">// \u5F00\u59CB\u89E3\u6790</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> exportsData </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">parse</span><span style="color:#A6ACCD;">(sourceStr)</span></span>
<span class="line"><span style="color:#676E95;">// \u7ED3\u679C\u4E3A\u4E00\u4E2A\u6570\u7EC4\uFF0C\u5206\u522B\u4FDD\u5B58 import \u548C export \u7684\u4FE1\u606F</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">imports</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> exports</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> exportsData</span></span>
<span class="line"><span style="color:#676E95;">// \u8FD4\u56DE \`import module from &#39;./a&#39;\`</span></span>
<span class="line"><span style="color:#A6ACCD;">sourceStr</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">substring</span><span style="color:#A6ACCD;">(imports[</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">]</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">ss</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> imports[</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">]</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">se)</span></span>
<span class="line"><span style="color:#676E95;">// \u8FD4\u56DE [&#39;count&#39;, &#39;default&#39;]</span></span>
<span class="line"><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">exports</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span></code></pre></div><p><code>export * from </code> \u5BFC\u51FA\u7684\u8BED\u6CD5\u4F1A\u88AB\u8BB0\u5F55\u5728 import \u4FE1\u606F\u4E2D\u3002</p><p><code>optimizeDeps</code> \u5229\u7528 <code>es-module-lexer</code> \u89E3\u6790\u5165\u53E3\u6587\u4EF6\u7684\u5B9E\u73B0\uFF1A</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki"><code><span class="line"><span style="color:#89DDFF;">import</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">init</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">parse</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">from</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">es-module-lexer</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#676E95;">// \u7701\u7565\u4E2D\u95F4\u7684\u4EE3\u7801</span></span>
<span class="line"><span style="color:#89DDFF;">await</span><span style="color:#A6ACCD;"> init</span></span>
<span class="line"><span style="color:#89DDFF;">for</span><span style="color:#A6ACCD;"> (</span><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> id </span><span style="color:#89DDFF;">in</span><span style="color:#A6ACCD;"> deps) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u7701\u7565\u524D\u9762\u7684\u8DEF\u5F84\u6241\u5E73\u5316\u903B\u8F91</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u8BFB\u53D6\u5165\u53E3\u5185\u5BB9</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">entryContent</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">fs</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">readFileSync</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">filePath</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">utf-8</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">try</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">exportsData</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">parse</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">entryContent</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">as</span><span style="color:#F07178;"> </span><span style="color:#FFCB6B;">ExportsData</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">catch</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u7701\u7565\u5BF9 jsx \u7684\u5904\u7406</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">for</span><span style="color:#F07178;"> (</span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ss</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">se</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">of</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">exportsData</span><span style="color:#F07178;">[</span><span style="color:#F78C6C;">0</span><span style="color:#F07178;">]) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">exp</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">entryContent</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">slice</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">ss</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">se</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;">// \u6807\u8BB0\u5B58\u5728 \`export * from\` \u8BED\u6CD5</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">if</span><span style="color:#F07178;"> (</span><span style="color:#89DDFF;">/</span><span style="color:#C3E88D;">export\\s</span><span style="color:#89DDFF;">+*</span><span style="color:#C3E88D;">\\s</span><span style="color:#89DDFF;">+</span><span style="color:#C3E88D;">from</span><span style="color:#89DDFF;">/</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">test</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">exp</span><span style="color:#F07178;">)) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      </span><span style="color:#A6ACCD;">exportsData</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">hasReExports</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u5C06 import \u548C export \u4FE1\u606F\u8BB0\u5F55\u4E0B\u6765</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">idToExports</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">id</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">exportsData</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">flatIdToExports</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">flatId</span><span style="color:#F07178;">] </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">exportsData</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u7531\u4E8E\u6700\u540E\u4F1A\u6709\u4E24\u5F20\u8868\u8BB0\u5F55\u4E0B ES \u6A21\u5757\u5BFC\u5165\u548C\u5BFC\u51FA\u7684\u76F8\u5173\u4FE1\u606F\uFF0C\u800C flatIdToExports \u8868\u4F1A\u4F5C\u4E3A\u5165\u53C2\u4F20\u7ED9 Esbuild \u63D2\u4EF6:</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki"><code><span class="line"><span style="color:#676E95;">// \u7B2C\u4E8C\u4E2A\u5165\u53C2</span></span>
<span class="line"><span style="color:#82AAFF;">esbuildDepPlugin</span><span style="color:#A6ACCD;">(flatIdDeps</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> flatIdToExports</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> config</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> ssr)</span></span>
<span class="line"></span></code></pre></div><p>\u5982\u6B64\uFF0C\u5C31\u80FD\u6839\u636E\u771F\u5B9E\u6A21\u5757\u7684\u8DEF\u5F84\u83B7\u53D6\u5230\u5BFC\u5165\u548C\u5BFC\u51FA\u7684\u4FE1\u606F\uFF0C\u901A\u8FC7\u8FD9\u4EFD\u4FE1\u606F\u6765\u7504\u522B CommonJS \u548C ES \u4E24\u79CD\u6A21\u5757\u89C4\u8303\u3002\u73B0\u5728\u53EF\u4EE5\u56DE\u5230 Esbuild \u6253\u5305\u63D2\u4EF6\u4E2D\u52A0\u8F7D\u4EE3\u7406\u6A21\u5757\u7684\u4EE3\u7801:</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki"><code><span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> contents </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#676E95;">// \u4E0B\u9762\u7684 exportsData \u5373\u5916\u90E8\u4F20\u5165\u7684\u6A21\u5757\u5BFC\u5165\u5BFC\u51FA\u76F8\u5173\u7684\u4FE1\u606F\u8868</span></span>
<span class="line"><span style="color:#676E95;">// \u6839\u636E\u6A21\u5757 id \u62FF\u5230\u5BF9\u5E94\u7684\u5BFC\u5165\u5BFC\u51FA\u4FE1\u606F</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> data </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> exportsData[id]</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[</span><span style="color:#A6ACCD;">imports</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> exports</span><span style="color:#89DDFF;">]</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> data</span></span>
<span class="line"><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">!</span><span style="color:#A6ACCD;">imports</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">length </span><span style="color:#89DDFF;">&amp;&amp;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">!exports.</span><span style="color:#A6ACCD;">length) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u5904\u7406 CommonJS \u6A21\u5757</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">else</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u5904\u7406 ES  \u6A21\u5757</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u5982\u679C\u662F CommonJS \u6A21\u5757\uFF0C\u5219\u5BFC\u51FA\u8BED\u53E5\u5199\u6210\u8FD9\u79CD\u5F62\u5F0F:</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki"><code><span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> contents </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">contents </span><span style="color:#89DDFF;">+=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">export default require( </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">relativePath</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;"> );</span><span style="color:#89DDFF;">\`</span></span>
<span class="line"></span></code></pre></div><p>\u5982\u679C\u662F ES \u6A21\u5757\uFF0C\u5219\u5206\u9ED8\u8BA4\u5BFC\u51FA\u548C\u975E\u9ED8\u8BA4\u5BFC\u51FA\u8FD9\u4E24\u79CD\u60C5\u51B5\u6765\u5904\u7406:</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki"><code><span class="line"><span style="color:#676E95;">// \u9ED8\u8BA4\u5BFC\u51FA\uFF0C\u5373\u5B58\u5728 export default \u8BED\u6CD5</span></span>
<span class="line"><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> (</span><span style="color:#89DDFF;">exports.</span><span style="color:#82AAFF;">includes</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">default</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">contents</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">\`</span><span style="color:#C3E88D;">import d from  </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">relativePath</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;"> ;export default d;</span><span style="color:#89DDFF;">\`</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#676E95;">// \u975E\u9ED8\u8BA4\u5BFC\u51FA</span></span>
<span class="line"><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> (</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// 1. \u5B58\u5728 \`export * from\` \u8BED\u6CD5\uFF0C\u524D\u6587\u5206\u6790\u8FC7</span></span>
<span class="line"><span style="color:#A6ACCD;">  data</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">hasReExports </span><span style="color:#89DDFF;">||</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// 2. \u591A\u4E2A\u5BFC\u51FA\u5185\u5BB9</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">exports.</span><span style="color:#A6ACCD;">length </span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">||</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// 3. \u53EA\u6709\u4E00\u4E2A\u5BFC\u51FA\u5185\u5BB9\uFF0C\u4F46\u8FD9\u4E2A\u5BFC\u51FA\u4E0D\u662F export default</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">exports</span><span style="color:#A6ACCD;">[</span><span style="color:#F78C6C;">0</span><span style="color:#A6ACCD;">] </span><span style="color:#89DDFF;">!==</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">default</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u51E1\u662F\u547D\u4E2D\u4E0A\u8FF0\u4E09\u79CD\u60C5\u51B5\u4E2D\u7684\u4E00\u79CD\uFF0C\u5219\u6DFB\u52A0\u4E0B\u9762\u7684\u91CD\u5BFC\u51FA\u8BED\u53E5</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#A6ACCD;">contents</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">+=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">\`</span><span style="color:#A6ACCD;">\\n</span><span style="color:#C3E88D;">export * from  </span><span style="color:#89DDFF;">\${</span><span style="color:#A6ACCD;">relativePath</span><span style="color:#89DDFF;">}</span><span style="color:#C3E88D;"> </span><span style="color:#89DDFF;">\`</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><p>\u73B0\u5728\uFF0C\u7EC4\u88C5\u597D\u4E86\u4EE3\u7406\u6A21\u5757\u7684\u5185\u5BB9\uFF0C\u63A5\u4E0B\u6765\u5C31\u53EF\u4EE5\u653E\u5FC3\u5730\u4EA4\u7ED9 Esbuild \u52A0\u8F7D\u4E86:</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki"><code><span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> ext </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> path</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">extname</span><span style="color:#A6ACCD;">(entryFile)</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">slice</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">1</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#89DDFF;">if</span><span style="color:#A6ACCD;"> (ext </span><span style="color:#89DDFF;">===</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">mjs</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">) ext </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">js</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#89DDFF;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">loader</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> ext </span><span style="color:#89DDFF;">as</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Loader</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">  </span><span style="color:#676E95;">// \u865A\u62DF\u6A21\u5757\u5185\u5BB9</span></span>
<span class="line"><span style="color:#A6ACCD;">  contents</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">resolveDir</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> root</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span></code></pre></div><h4 id="\u4EE3\u7406\u6A21\u5757\u4E3A\u4EC0\u4E48\u8981\u548C\u771F\u5B9E\u6A21\u5757\u5206\u79BB" tabindex="-1">\u4EE3\u7406\u6A21\u5757\u4E3A\u4EC0\u4E48\u8981\u548C\u771F\u5B9E\u6A21\u5757\u5206\u79BB\uFF1F <a class="header-anchor" href="#\u4EE3\u7406\u6A21\u5757\u4E3A\u4EC0\u4E48\u8981\u548C\u771F\u5B9E\u6A21\u5757\u5206\u79BB" aria-hidden="true">#</a></h4><p>\u73B0\u5728\u5DF2\u7ECF\u6E05\u695A\u4E86 Vite \u662F\u5982\u4F55\u7EC4\u88C5\u4EE3\u7406\u6A21\u5757\uFF0C\u4EE5\u6B64\u4F5C\u4E3A Esbuild \u6253\u5305\u5165\u53E3\u7684\uFF0C\u6574\u4F53\u7684\u601D\u8DEF\u5C31\u662F\u5148\u5206\u6790\u4E00\u904D\u6A21\u5757\u771F\u5B9E\u5165\u53E3\u6587\u4EF6\u7684 import \u548C export \u8BED\u6CD5\uFF0C\u7136\u540E\u5728\u4EE3\u7406\u6A21\u5757\u4E2D\u8FDB\u884C\u91CD\u5BFC\u51FA\u3002\u8FD9\u91CC\u4E0D\u59A8\u56DE\u8FC7\u5934\u6765\u601D\u8003\u4E00\u4E0B: \u4E3A\u4EC0\u4E48\u8981\u5BF9\u771F\u5B9E\u6587\u4EF6\u5148\u505A\u8BED\u6CD5\u5206\u6790\uFF0C\u7136\u540E\u91CD\u5BFC\u51FA\u5185\u5BB9\u5462\uFF1F</p><p>\u5BF9\u6B64\uFF0C\u5927\u5BB6\u4E0D\u59A8\u6CE8\u610F\u4E00\u4E0B\u4EE3\u7801\u4E2D\u7684\u8FD9\u6BB5\u6CE8\u91CA:</p><div class="language-ts"><button title="Copy Code" class="copy"></button><span class="lang">ts</span><pre class="shiki"><code><span class="line"><span style="color:#676E95;">// It is necessary to do the re-exporting to separate the virtual proxy</span></span>
<span class="line"><span style="color:#676E95;">// module from the actual module since the actual module may get</span></span>
<span class="line"><span style="color:#676E95;">// referenced via relative imports - if we don&#39;t separate the proxy and</span></span>
<span class="line"><span style="color:#676E95;">// the actual module, esbuild will create duplicated copies of the same</span></span>
<span class="line"><span style="color:#676E95;">// module!</span></span>
<span class="line"></span></code></pre></div><p>\u7FFB\u8BD1\u8FC7\u6765\u5373:</p><blockquote><p>\u8FD9\u79CD\u91CD\u5BFC\u51FA\u7684\u505A\u6CD5\u662F\u5FC5\u8981\u7684\uFF0C\u5B83\u53EF\u4EE5\u5206\u79BB\u865A\u62DF\u6A21\u5757\u548C\u771F\u5B9E\u6A21\u5757\uFF0C\u56E0\u4E3A\u771F\u5B9E\u6A21\u5757\u53EF\u4EE5\u901A\u8FC7\u76F8\u5BF9\u5730\u5740\u6765\u5F15\u5165\u3002\u5982\u679C\u4E0D\u8FD9\u4E48\u505A\uFF0CEsbuild \u5C06\u4F1A\u5BF9\u6253\u5305\u8F93\u51FA\u4E24\u4E2A\u4E00\u6837\u7684\u6A21\u5757\u3002</p></blockquote><p>\u5982\u679C\u4EE3\u7406\u6A21\u5757\u901A\u8FC7\u6587\u4EF6\u7CFB\u7EDF\u76F4\u63A5\u8BFB\u53D6\u771F\u5B9E\u6A21\u5757\u7684\u5185\u5BB9\uFF0C\u800C\u4E0D\u662F\u8FDB\u884C\u91CD\u5BFC\u51FA\uFF0C\u56E0\u6B64\u7531\u4E8E\u6B64\u65F6\u4EE3\u7406\u6A21\u5757\u8DDF\u771F\u5B9E\u6A21\u5757\u5E76\u6CA1\u6709\u4EFB\u4F55\u7684\u5F15\u7528\u5173\u7CFB\uFF0C\u8FD9\u5C31\u5BFC\u81F4\u6700\u540E\u7684 react.js \u548C @emotion/react.js \u4E24\u4EFD\u4EA7\u7269\u5E76\u4E0D\u4F1A\u5F15\u7528\u540C\u4E00\u4EFD Chunk\uFF0CEsbuild \u6700\u540E\u6253\u5305\u51FA\u4E86\u5185\u5BB9\u5B8C\u5168\u76F8\u540C\u7684\u4E24\u4E2A Chunk\uFF01</p><p>\u8FD9\u4E5F\u5C31\u80FD\u89E3\u91CA\u4E3A\u4EC0\u4E48 Vite \u4E2D\u8981\u5728\u4EE3\u7406\u6A21\u5757\u4E2D\u5BF9\u771F\u5B9E\u6A21\u5757\u7684\u5185\u5BB9\u8FDB\u884C\u91CD\u5BFC\u51FA\u4E86\uFF0C\u4E3B\u8981\u662F\u4E3A\u4E86\u907F\u514D Esbuild \u4EA7\u751F\u91CD\u590D\u7684\u6253\u5305\u5185\u5BB9\u3002</p>`,99),e=[o];function t(c,r,F,y,D,C){return a(),n("div",null,e)}const d=s(p,[["render",t]]);export{i as __pageData,d as default};
